import{_ as Qt,u as Wt,r as m,i as g,j as tt,o as Yt,H as Xt,A as te,c as i,e,B as ee,f as _,g as y,t as c,k as Z,y as U,F as H,G as et,d as se,n as f,w as st,v as vt,q as Mt,s as Bt,z as ae,T as $t,D as oe,m as ne,I as At,p as le,J as re,h as r}from"./index-CX6fTkOy.js";import{u as ie}from"./useFormatting-CP8YxVhJ.js";import{C as mt}from"./CustomDropdown-LrCUM5C5.js";const ce={class:"reports-page cpt"},ue={class:"reports-main"},de={class:"reports-topbar"},pe={class:"reports-topbar-left"},ve={class:"cpt-status-badges"},me={key:0,class:"cpt-sync-badge"},fe={class:"reports-topbar-right"},_e={class:"reports-stats-row"},ge={class:"reports-stat-box"},ye={key:0,class:"reports-stat-value"},he={key:1,class:"reports-stat-value reports-stat-stacked"},ke={class:"reports-stat-box"},be={key:0,class:"reports-stat-value"},we={key:1,class:"reports-stat-value reports-stat-stacked"},Ce={class:"reports-stat-box"},Te={class:"reports-stat-value reports-stat-success"},Se={class:"reports-stat-box"},De={class:"reports-stat-value reports-stat-danger"},xe={class:"reports-stat-box"},Me={class:"reports-stat-value"},Be={class:"cpt-content"},$e={class:"cpt-chart-panel"},Ae={class:"cpt-chart-header"},Fe={class:"cpt-chart-controls"},Ie={class:"cpt-range-tabs"},Ve={class:"cpt-transactions-panel"},Ee={class:"cpt-filters-bar"},Le={class:"cpt-search"},Re={class:"cpt-filters-actions"},Ue={class:"cpt-filters-trigger-wrapper"},Pe={key:0,class:"cpt-filter-badge"},je={class:"cpt-popover-section"},ze={class:"cpt-popover-status"},Ne={class:"cpt-popover-section"},Oe={class:"cpt-popover-checkbox"},qe={class:"cpt-popover-section"},Ze={class:"cpt-popover-dates"},He={class:"cpt-popover-footer"},Ge=["disabled"],Ke={key:0,class:"cpt-active-filter"},Je={key:1,class:"cpt-active-filter"},Qe={class:"cpt-table-container"},We={class:"cpt-table"},Ye={key:0,viewBox:"0 0 24 24"},Xe=["d"],ts={key:0},es={key:1},ss=["onClick"],as={class:"cpt-cell-date"},os={class:"time"},ns={class:"cpt-cell-customer"},ls={class:"name"},rs={class:"email"},is={class:"amount-col"},cs={class:"cpt-amount"},us={class:"cpt-cell-status"},ds={key:0,class:"cpt-flag test"},ps={key:1,class:"cpt-flag refund"},vs={key:2,class:"cpt-flag chargeback"},ms={class:"cpt-site"},fs={class:"cpt-pagination"},_s={class:"cpt-pagination-info"},gs={class:"cpt-pagination-controls"},ys=["disabled"],hs={key:0,class:"ellipsis"},ks=["onClick"],bs=["disabled"],ws={class:"cpt-slideout"},Cs={class:"cpt-slideout-header"},Ts={class:"cpt-slideout-header-left"},Ss={class:"cpt-slideout-subtitle"},Ds={class:"cpt-slideout-content"},xs={class:"cpt-slideout-hero-amount"},Ms={class:"cpt-slideout-hero-meta"},Bs={key:0,class:"cpt-slideout-flags"},$s={key:0,class:"cpt-slideout-flag test"},As={key:1,class:"cpt-slideout-flag refund"},Fs={key:2,class:"cpt-slideout-flag chargeback"},Is={class:"cpt-slideout-section"},Vs={class:"cpt-slideout-card"},Es={class:"cpt-slideout-card-row"},Ls={class:"cpt-slideout-card-value"},Rs={class:"cpt-slideout-card-row"},Us={class:"cpt-slideout-card-value"},Ps={class:"cpt-slideout-section"},js={class:"cpt-slideout-card"},zs={class:"cpt-slideout-card-row"},Ns={class:"cpt-slideout-card-value mono"},Os={class:"cpt-slideout-card-row"},qs={class:"cpt-slideout-card-value mono"},Zs={class:"cpt-slideout-card-row"},Hs={class:"cpt-slideout-card-value mono"},Gs={class:"cpt-slideout-footer"},Ks="America/Los_Angeles",G=25,Js={__name:"CptReportsView",setup(Qs){const{supabase:T}=ne(),{user:at}=Wt(),{formatCurrency:P,formatCurrencyShort:ft}=ie(),{info:Ft}=le();let K=null,h=null;const It=[{value:"America/New_York",label:"Eastern (ET)"},{value:"America/Chicago",label:"Central (CT)"},{value:"America/Denver",label:"Mountain (MT)"},{value:"America/Los_Angeles",label:"Pacific (PT)"},{value:"America/Toronto",label:"Toronto (ET)"},{value:"America/Vancouver",label:"Vancouver (PT)"},{value:"UTC",label:"UTC"},{value:"Europe/London",label:"London (GMT/BST)"},{value:"Europe/Paris",label:"Paris (CET)"},{value:"Asia/Tokyo",label:"Tokyo (JST)"},{value:"Asia/Shanghai",label:"Shanghai (CST)"},{value:"Australia/Sydney",label:"Sydney (AEST)"}],ot=m(!0),S=m([]),J=m([]),V=m([]),nt=m(null),j=m({}),_t=m(null),z=m(""),$=m(""),A=m(""),b=m(""),w=m(""),v=m("all"),D=m("America/Los_Angeles"),x=m("30d"),F=m(!1),C=m(1),M=m({column:"transaction_date",direction:"desc"}),Q=m(!1),u=m(null),E=m(!1),Vt=m(null);function Et(){E.value=!E.value}function lt(){E.value=!1}const rt=g(()=>{let a=0;return v.value!=="all"&&a++,b.value&&a++,w.value&&a++,A.value&&a++,F.value&&a++,a}),it=g(()=>{const a=J.value.filter(n=>!n.is_test),t=a.filter(n=>n.status==="complete"),s={};for(const n of t){const l=n.currency||"CAD";s[l]=(s[l]||0)+parseFloat(n.cust_amount||0)}const o=Object.values(s).reduce((n,l)=>n+l,0);return{totalCaptured:o,totalCapturedByCurrency:s,completed:t.length,cancelled:a.length-t.length,avgAmount:t.length?o/t.length:0,completionRate:a.length?(t.length/a.length*100).toFixed(1):0,total:a.length}}),I=g(()=>{const a=L(new Date);return j.value[a]||{complete:0,cancelled:0,volume:0,volumeByCurrency:{}}}),Lt=g(()=>{const a=I.value,t=a.complete+a.cancelled;return t?(a.complete/t*100).toFixed(1):0}),Rt=g(()=>{const{year:a,month:t,day:s}=ct(),o=new Date(a,t,s-1),n=L(o);return j.value[n]||{complete:0,cancelled:0,volume:0}});g(()=>{const a=I.value.volume,t=Rt.value.volume;if(!t)return{direction:"neutral",percent:0};const s=(a-t)/t*100;return{direction:s>0?"up":s<0?"down":"neutral",percent:Math.abs(s).toFixed(0)}});const Ut=g(()=>{const a=[...new Set(S.value.map(t=>t.site_name).filter(Boolean))].sort();return[{value:"",label:`All Sites (${a.length})`},...a.map(t=>({value:t,label:t}))]}),Pt=g(()=>{const a=[...new Set(S.value.map(t=>t.currency).filter(Boolean))].sort();return[{value:"",label:"All Currencies"},...a.map(t=>({value:t,label:t}))]}),gt=g(()=>Math.ceil(V.value.length/G)),yt=g(()=>{const a=(C.value-1)*G;return V.value.slice(a,a+G)}),jt=g(()=>{const a=V.value.length;return a?`${(C.value-1)*G+1}–${Math.min(C.value*G,a)} of ${a.toLocaleString()}`:"No transactions"}),zt=g(()=>{const a=gt.value,t=C.value;return a<=7?Array.from({length:a},(s,o)=>o+1):t<=3?[1,2,3,4,"...",a]:t>=a-2?[1,"...",a-3,a-2,a-1,a]:[1,"...",t-1,t,t+1,"...",a]}),Nt=g(()=>A.value||b.value||w.value||v.value!=="all"||F.value);g(()=>{const{year:a,month:t,day:s}=ct(),o=[];for(let n=13;n>=0;n--){const l=new Date(a,t,s-n),d=L(l),p=j.value[d]||{volume:0};o.push(p.volume)}return o});function ht(a){const t=a==null?void 0:a.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})/);if(!t)return new Date(a);const s=new Date(t[1]+"Z"),o=s.toLocaleString("en-US",{timeZone:Ks,hour12:!1}),n=s.toLocaleString("en-US",{timeZone:"UTC",hour12:!1}),l=new Date(n)-new Date(o);return new Date(s.getTime()+l)}function W(a){const t=ht(a);return{date:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",timeZone:D.value}),time:t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZone:D.value})}}function L(a){const t=new Intl.DateTimeFormat("en-US",{timeZone:D.value,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(a),s=o=>t.find(n=>n.type===o).value;return`${s("year")}-${s("month")}-${s("day")}`}function ct(){const a=new Intl.DateTimeFormat("en-US",{timeZone:D.value,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(new Date),t=s=>parseInt(a.find(o=>o.type===s).value);return{year:t("year"),month:t("month")-1,day:t("day")}}function kt(){const a={},{year:t,month:s,day:o}=ct(),n=new Date(t,s,o-90),l=L(n);for(const d of J.value){if(d.is_test)continue;const p=L(ht(d.transaction_date));if(!(p<l))if(a[p]=a[p]||{complete:0,cancelled:0,volume:0,volumeByCurrency:{}},d.status==="complete"){a[p].complete++,a[p].volume+=parseFloat(d.cust_amount||0);const B=d.currency||"CAD";a[p].volumeByCurrency[B]=(a[p].volumeByCurrency[B]||0)+parseFloat(d.cust_amount||0)}else a[p].cancelled++}j.value=a}function Ot(a){const s=new Date-a,o=Math.floor(s/6e4),n=Math.floor(s/36e5),l=Math.floor(s/864e5);return o<1?"just now":o<60?`${o}m ago`:n<24?`${n}h ago`:`${l}d ago`}async function ut(){ot.value=!0;try{const{data:a}=await T.from("cpt_site_accounts").select("site_id").eq("is_active",!0),t=(a||[]).map(d=>d.site_id),s=1e3;let o=[],n=0,l=!0;for(;l;){let d=T.from("cpt_data").select("*").order("transaction_date",{ascending:!1}).range(n,n+s-1);t.length&&(d=d.in("site_id",t));const{data:p,error:B}=await d;if(B)throw B;p&&p.length>0?(o=o.concat(p),n+=s,l=p.length===s):l=!1}S.value=o.map(d=>({...d,status:d.trans_type==="complete"?"complete":"incomplete"})),Y()}catch(a){console.error("Error loading data:",a)}finally{ot.value=!1}}async function bt(){var a,t;try{let{data:s}=await T.from("cpt_sync_log").select("sync_completed_at, sync_started_at, status").eq("status","success").order("sync_completed_at",{ascending:!1}).limit(1);s!=null&&s.length||(s=(await T.from("cpt_sync_log").select("sync_completed_at, sync_started_at").order("sync_started_at",{ascending:!1}).limit(1)).data);const o=((a=s==null?void 0:s[0])==null?void 0:a.sync_completed_at)||((t=s==null?void 0:s[0])==null?void 0:t.sync_started_at);o&&(nt.value=new Date(o))}catch(s){console.error("Error loading sync status:",s)}}function Y(){let a=[...S.value];z.value&&(a=a.filter(t=>t.site_name===z.value)),$.value&&(a=a.filter(t=>t.currency===$.value)),J.value=a,kt(),k(),At(Ct)}function k(){const a=A.value.toLowerCase();V.value=J.value.filter(t=>{if(!F.value&&t.is_test||v.value==="complete"&&t.status!=="complete"||v.value==="incomplete"&&t.status!=="incomplete"||v.value==="refund"&&!t.is_refund||v.value==="chargeback"&&!t.is_chargeback||a&&![t.cust_name,t.cust_email_ad,t.cust_trans_id,t.site_name].join(" ").toLowerCase().includes(a)||b.value&&new Date(t.transaction_date)<new Date(b.value))return!1;if(w.value){const s=new Date(w.value);if(s.setUTCHours(23,59,59,999),new Date(t.transaction_date)>s)return!1}return!0}),wt(),C.value=1}function wt(){const{column:a,direction:t}=M.value,s=t==="asc"?1:-1;V.value.sort((o,n)=>{let l=o[a],d=n[a];return a==="transaction_date"?(l=new Date(l),d=new Date(d)):a==="cust_amount"?(l=parseFloat(l||0),d=parseFloat(d||0)):(l=(l||"").toString().toLowerCase(),d=(d||"").toString().toLowerCase()),l<d?-s:l>d?s:0})}function N(a){M.value.column===a?M.value.direction=M.value.direction==="asc"?"desc":"asc":M.value={column:a,direction:"desc"},wt()}function qt(){A.value="",b.value="",w.value="",v.value="all",F.value=!1,k()}function Zt(a){D.value=a,kt(),At(Ct)}async function Ht(){if(!K)try{const a=await re(()=>import("./auto-CpL4W96M.js"),[]);K=a.default||a.Chart}catch(a){console.error("Failed to load Chart.js:",a)}}async function Ct(){if(await Ht(),!K)return;const a=document.getElementById("volumeChart");if(a){h==null||h.destroy();const t=a.getContext("2d");h=new K(t,{type:"bar",data:{labels:[],datasets:[{label:"Volume",data:[],backgroundColor:"rgba(16, 185, 129, 0.8)",borderRadius:6,borderSkipped:!1,barPercentage:.6,categoryPercentage:.8}],transactionCounts:[]},options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:400,easing:"easeOutQuart"},transitions:{active:{animation:{duration:0}}},interaction:{intersect:!1,mode:"index"},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.95)",titleColor:"#f1f5f9",bodyColor:"#cbd5e1",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,padding:12,cornerRadius:8,displayColors:!1,boxPadding:4,titleFont:{family:"Inter, -apple-system, sans-serif",size:13,weight:"600"},bodyFont:{family:"Inter, -apple-system, sans-serif",size:12},callbacks:{label:function(s){const o=s.raw||0;return"Volume: "+new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o)},afterBody:function(s){var l;const o=s[0].dataIndex,n=((l=this.chart.data.transactionCounts)==null?void 0:l[o])||{complete:0,cancelled:0};return`
${n.complete} completed, ${n.cancelled} cancelled`}}}},scales:{x:{grid:{display:!1},ticks:{color:"#64748b",font:{family:"Inter, -apple-system, sans-serif",size:11}},border:{display:!1}},y:{grid:{color:"rgba(255, 255, 255, 0.06)"},ticks:{color:"#64748b",font:{family:"Inter, -apple-system, sans-serif",size:11},callback:function(s){return"$"+(s>=1e3?(s/1e3).toFixed(0)+"k":s)}},border:{display:!1}}}}}),X()}}function X(){if(!h)return;const a=x.value==="7d"?7:x.value==="30d"?30:90,t=[],s=[],o=[];for(let n=a-1;n>=0;n--){const l=new Date;l.setDate(l.getDate()-n);const d=L(l),p=j.value[d]||{complete:0,cancelled:0,volume:0};t.push(l.toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:D.value})),s.push(p.volume),o.push({complete:p.complete,cancelled:p.cancelled})}h.data.labels=t,h.data.datasets[0].data=s,h.data.transactionCounts=o,h.update()}function Gt(a){u.value=a,Q.value=!0}function O(){Q.value=!1,u.value=null}async function Tt(a,t){var n,l,d;const s=u.value;if(!s)return;const o=!s[a];try{const{error:p}=await T.from("cpt_data").update({[a]:o,[t]:o?new Date().toISOString():null,marked_by:o?(n=at.value)==null?void 0:n.id:null}).eq("cust_session",s.cust_session).eq("transaction_date",s.transaction_date);if(p)throw p;if(s.settlement_report_id){const R=a==="is_refund"?"refund":"chargeback";if(o){const{data:q}=await T.from("settlement_reports").select("id, report_number, status, processing_fee_percent").eq("id",s.settlement_report_id).single();if(q&&q.status==="paid"){const dt=parseFloat(s.cust_amount||0),xt=parseFloat(q.processing_fee_percent||0),Jt=dt*(xt/100),{error:pt}=await T.from("settlement_adjustments").insert({site_id:s.site_id,site_name:s.site_name,original_cust_session:s.cust_session,original_transaction_date:s.transaction_date,original_cust_name:s.cust_name,original_cust_email:s.cust_email_ad,original_trans_id:s.cust_trans_id,original_settlement_report_id:q.id,original_settlement_report_number:q.report_number,amount:dt,reason:R,status:"pending",original_processing_fee_percent:xt,processing_fee_credit:Jt,created_by:(l=at.value)==null?void 0:l.id,notes:`Auto-created when transaction marked as ${R}`});pt&&!((d=pt.message)!=null&&d.includes("unique"))?console.error("Error creating adjustment:",pt):Ft(`Settlement adjustment created: -${P(dt)} will be deducted from ${s.site_name}'s next settlement`)}}else await T.from("settlement_adjustments").delete().eq("original_cust_session",s.cust_session).eq("original_transaction_date",s.transaction_date).eq("reason",R).eq("status","pending")}s[a]=o;const B=S.value.findIndex(R=>R.cust_session===s.cust_session&&R.transaction_date===s.transaction_date);B!==-1&&(S.value[B][a]=o),Y()}catch(p){console.error(`Error updating ${a}:`,p),alert(`Failed to update ${a}`)}}async function St(){var s;const a=u.value;if(!a)return;const t=!a.is_test;try{const{error:o}=await T.from("cpt_data").update({is_test:t,test_marked_at:t?new Date().toISOString():null,marked_by:t?(s=at.value)==null?void 0:s.id:null}).eq("cust_session",a.cust_session).eq("transaction_date",a.transaction_date);if(o)throw o;a.is_test=t;const n=S.value.findIndex(l=>l.cust_session===a.cust_session&&l.transaction_date===a.transaction_date);n!==-1&&(S.value[n].is_test=t),Y()}catch(o){console.error("Error updating is_test:",o),alert("Failed to update test status")}}function Kt(){const a=["Date","Customer Name","Email","Amount","Currency","Status","Site","Transaction ID"],t=V.value.map(n=>[new Date(n.transaction_date).toISOString(),n.cust_name||"",n.cust_email_ad||"",n.cust_amount||0,n.currency||"CAD",n.status,n.site_name||"",n.cust_trans_id||""]),s=[a,...t].map(n=>n.map(l=>`"${String(l).replace(/"/g,'""')}"`).join(",")).join(`
`),o=document.createElement("a");o.href=URL.createObjectURL(new Blob([s],{type:"text/csv"})),o.download=`cpt-transactions-${new Date().toISOString().split("T")[0]}.csv`,o.click()}async function Dt(a){var t;a.key==="Escape"&&O(),(a.metaKey||a.ctrlKey)&&a.key==="k"&&(a.preventDefault(),(t=_t.value)==null||t.focus()),(a.key==="t"||a.key==="T")&&Q.value&&u.value&&(a.preventDefault(),await St(),O())}return tt(A,k),tt([b,w],k),tt([z,$],Y),tt(F,k),Yt(async()=>{document.addEventListener("keydown",Dt),await Promise.all([ut(),bt()])}),Xt(async()=>{await ut()}),te(()=>{document.removeEventListener("keydown",Dt),h==null||h.destroy()}),(a,t)=>(r(),i("div",ce,[t[72]||(t[72]=e("div",{class:"reports-bg"},[e("div",{class:"reports-grid"}),e("div",{class:"reports-glow reports-glow-1"}),e("div",{class:"reports-glow reports-glow-2"})],-1)),e("div",ue,[e("header",de,[e("div",pe,[t[29]||(t[29]=e("div",{class:"reports-page-title"},[e("span",{class:"reports-breadcrumb"},"Reports"),e("h1",null,"Transactions")],-1)),e("div",ve,[t[28]||(t[28]=e("span",{class:"cpt-live"},[e("span",{class:"cpt-live-dot"}),y("Live")],-1)),nt.value?(r(),i("span",me,c(Ot(nt.value)),1)):_("",!0)])]),e("div",fe,[Z(mt,{modelValue:z.value,"onUpdate:modelValue":t[0]||(t[0]=s=>z.value=s),options:Ut.value,placeholder:"All Sites",class:"cpt-site-select"},null,8,["modelValue","options"]),Z(mt,{modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=s=>$.value=s),options:Pt.value,placeholder:"All Currencies",class:"cpt-site-select"},null,8,["modelValue","options"]),e("button",{class:"reports-icon-btn",onClick:t[2]||(t[2]=s=>{ut(),bt()}),title:"Refresh"},[...t[30]||(t[30]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),e("button",{class:"cpt-export-btn",onClick:Kt},[...t[31]||(t[31]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 10v6m0 0l-3-3m3 3l3-3M3 17v2a2 2 0 002 2h14a2 2 0 002-2v-2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),y(" Export ",-1)])])])]),e("div",_e,[e("div",ge,[$.value||Object.keys(it.value.totalCapturedByCurrency).length<=1?(r(),i("div",ye,c(U(ft)(it.value.totalCaptured)),1)):(r(),i("div",he,[(r(!0),i(H,null,et(it.value.totalCapturedByCurrency,(s,o)=>(r(),i("span",{key:o},c(U(P)(s,o)),1))),128))])),t[32]||(t[32]=e("span",{class:"reports-stat-label"},"Total Revenue",-1))]),e("div",ke,[$.value||Object.keys(I.value.volumeByCurrency).length<=1?(r(),i("div",be,c(U(ft)(I.value.volume)),1)):(r(),i("div",we,[(r(!0),i(H,null,et(I.value.volumeByCurrency,(s,o)=>(r(),i("span",{key:o},c(U(P)(s,o)),1))),128))])),t[33]||(t[33]=e("span",{class:"reports-stat-label"},"Today",-1))]),e("div",Ce,[e("span",Te,c(I.value.complete),1),t[34]||(t[34]=e("span",{class:"reports-stat-label"},"Completed",-1))]),e("div",Se,[e("span",De,c(I.value.cancelled),1),t[35]||(t[35]=e("span",{class:"reports-stat-label"},"Cancelled",-1))]),e("div",xe,[e("span",Me,c(Lt.value)+"%",1),t[36]||(t[36]=e("span",{class:"reports-stat-label"},"Success Rate",-1))])]),e("div",Be,[e("section",$e,[e("div",Ae,[t[37]||(t[37]=se('<div class="cpt-chart-legend" data-v-4c4eea03><span class="cpt-legend-item" data-v-4c4eea03><span class="cpt-legend-dot completed" data-v-4c4eea03></span>Completed</span><span class="cpt-legend-item" data-v-4c4eea03><span class="cpt-legend-dot cancelled" data-v-4c4eea03></span>Cancelled</span></div>',1)),e("div",Fe,[e("div",Ie,[e("button",{class:f({active:x.value==="7d"}),onClick:t[3]||(t[3]=s=>{x.value="7d",X()})},"7D",2),e("button",{class:f({active:x.value==="30d"}),onClick:t[4]||(t[4]=s=>{x.value="30d",X()})},"30D",2),e("button",{class:f({active:x.value==="90d"}),onClick:t[5]||(t[5]=s=>{x.value="90d",X()})},"90D",2)])])]),t[38]||(t[38]=e("div",{class:"cpt-chart-container"},[e("canvas",{id:"volumeChart"})],-1))]),e("section",Ve,[e("div",Ee,[e("div",Le,[t[39]||(t[39]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"M21 21l-4.35-4.35"})],-1)),st(e("input",{ref_key:"searchInputRef",ref:_t,"onUpdate:modelValue":t[6]||(t[6]=s=>A.value=s),type:"text",placeholder:"Search transactions..."},null,512),[[vt,A.value]]),t[40]||(t[40]=e("kbd",null,"⌘K",-1))]),e("div",Re,[e("div",Ue,[e("button",{ref_key:"filtersButtonRef",ref:Vt,class:f(["cpt-filters-btn",{active:E.value||rt.value>0}]),onClick:Et},[t[41]||(t[41]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 4h18M7 9h10M10 14h4M12 19h0","stroke-linecap":"round"})],-1)),t[42]||(t[42]=y(" Filters ",-1)),rt.value>0?(r(),i("span",Pe,c(rt.value),1)):_("",!0)],2),Z($t,{name:"popover"},{default:Mt(()=>[E.value?(r(),i("div",{key:0,class:"cpt-filters-popover",onClick:t[15]||(t[15]=Bt(()=>{},["stop"]))},[e("div",{class:"cpt-popover-header"},[t[44]||(t[44]=e("span",null,"Filters",-1)),e("button",{class:"cpt-popover-close",onClick:lt},[...t[43]||(t[43]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])]),e("div",je,[t[45]||(t[45]=e("label",{class:"cpt-popover-label"},"Status",-1)),e("div",ze,[e("button",{class:f({active:v.value==="all"}),onClick:t[7]||(t[7]=s=>{v.value="all",k()})},"All",2),e("button",{class:f({active:v.value==="complete"}),onClick:t[8]||(t[8]=s=>{v.value="complete",k()})},"Completed",2),e("button",{class:f({active:v.value==="incomplete"}),onClick:t[9]||(t[9]=s=>{v.value="incomplete",k()})},"Cancelled",2),e("button",{class:f({active:v.value==="refund"}),onClick:t[10]||(t[10]=s=>{v.value="refund",k()})},"Refunds",2),e("button",{class:f({active:v.value==="chargeback"}),onClick:t[11]||(t[11]=s=>{v.value="chargeback",k()})},"Chargebacks",2)])]),e("div",Ne,[e("label",Oe,[st(e("input",{type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=s=>F.value=s)},null,512),[[ae,F.value]]),t[46]||(t[46]=e("span",null,"Include test transactions",-1))])]),e("div",qe,[t[48]||(t[48]=e("label",{class:"cpt-popover-label"},"Date Range",-1)),e("div",Ze,[st(e("input",{type:"date","onUpdate:modelValue":t[13]||(t[13]=s=>b.value=s)},null,512),[[vt,b.value]]),t[47]||(t[47]=e("span",{class:"cpt-popover-date-sep"},"to",-1)),st(e("input",{type:"date","onUpdate:modelValue":t[14]||(t[14]=s=>w.value=s)},null,512),[[vt,w.value]])])]),e("div",He,[e("button",{class:"cpt-popover-clear",onClick:qt,disabled:!Nt.value},"Clear All",8,Ge),e("button",{class:"cpt-popover-apply",onClick:lt},"Done")])])):_("",!0)]),_:1})]),v.value!=="all"?(r(),i("div",Ke,[e("span",null,c(v.value==="complete"?"Completed":v.value==="incomplete"?"Cancelled":v.value==="refund"?"Refunds":"Chargebacks"),1),e("button",{onClick:t[16]||(t[16]=s=>{v.value="all",k()})},[...t[49]||(t[49]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])):_("",!0),b.value||w.value?(r(),i("div",Je,[e("span",null,c(b.value||"...")+" – "+c(w.value||"..."),1),e("button",{onClick:t[17]||(t[17]=s=>{b.value="",w.value="",k()})},[...t[50]||(t[50]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])):_("",!0)]),Z(mt,{modelValue:D.value,"onUpdate:modelValue":[t[18]||(t[18]=s=>D.value=s),Zt],options:It,placeholder:"Timezone",class:"cpt-tz-select cpt-tz-right"},null,8,["modelValue"])]),E.value?(r(),i("div",{key:0,class:"cpt-popover-backdrop",onClick:lt})):_("",!0),e("div",Qe,[e("table",We,[e("thead",null,[e("tr",null,[e("th",{onClick:t[19]||(t[19]=s=>N("transaction_date")),class:f(["sortable",{sorted:M.value.column==="transaction_date"}])},[t[51]||(t[51]=y(" Date ",-1)),M.value.column==="transaction_date"?(r(),i("svg",Ye,[e("path",{d:M.value.direction==="asc"?"M5 15l7-7 7 7":"M19 9l-7 7-7-7"},null,8,Xe)])):_("",!0)],2),e("th",{onClick:t[20]||(t[20]=s=>N("cust_name")),class:"sortable"},"Customer"),e("th",{onClick:t[21]||(t[21]=s=>N("cust_amount")),class:"sortable amount-col"},"Amount"),e("th",{onClick:t[22]||(t[22]=s=>N("status")),class:"sortable"},"Status"),e("th",{onClick:t[23]||(t[23]=s=>N("site_name")),class:"sortable"},"Site")])]),e("tbody",null,[ot.value?(r(),i("tr",ts,[...t[52]||(t[52]=[e("td",{colspan:"5"},[e("div",{class:"cpt-loading"},[e("div",{class:"cpt-spinner"}),e("span",null,"Loading transactions...")])],-1)])])):yt.value.length?(r(!0),i(H,{key:2},et(yt.value,s=>(r(),i("tr",{key:s.cust_session+s.transaction_date,onClick:o=>Gt(s),class:f({flagged:s.is_refund||s.is_chargeback})},[e("td",null,[e("div",as,[e("span",null,c(W(s.transaction_date).date),1),e("span",os,c(W(s.transaction_date).time),1)])]),e("td",null,[e("div",ns,[e("span",ls,c(s.cust_name||"—"),1),e("span",rs,c(s.cust_email_ad||"—"),1)])]),e("td",is,[e("span",cs,c(U(P)(parseFloat(s.cust_amount||0),s.currency)),1)]),e("td",null,[e("div",us,[e("span",{class:f(["cpt-status",s.status])},c(s.status==="complete"?"Completed":"Cancelled"),3),s.is_test?(r(),i("span",ds,"Test")):_("",!0),s.is_refund?(r(),i("span",ps,"Refund")):_("",!0),s.is_chargeback?(r(),i("span",vs,"CB")):_("",!0)])]),e("td",null,[e("span",ms,c(s.site_name||"—"),1)])],10,ss))),128)):(r(),i("tr",es,[...t[53]||(t[53]=[e("td",{colspan:"5"},[e("div",{class:"cpt-empty"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),e("span",null,"No transactions found")])],-1)])]))])])]),e("div",fs,[e("span",_s,c(jt.value),1),e("div",gs,[e("button",{disabled:C.value<=1,onClick:t[24]||(t[24]=s=>C.value--)},[...t[54]||(t[54]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M15 19l-7-7 7-7"})],-1)])],8,ys),(r(!0),i(H,null,et(zt.value,(s,o)=>(r(),i(H,{key:o},[s==="..."?(r(),i("span",hs,"...")):(r(),i("button",{key:1,class:f({active:s===C.value}),onClick:n=>C.value=s},c(s),11,ks))],64))),128)),e("button",{disabled:C.value>=gt.value,onClick:t[25]||(t[25]=s=>C.value++)},[...t[55]||(t[55]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 5l7 7-7 7"})],-1)])],8,bs)])])])])]),(r(),ee(oe,{to:"body"},[Z($t,{name:"slideout"},{default:Mt(()=>[Q.value&&u.value?(r(),i("div",{key:0,class:"cpt-slideout-overlay",onClick:Bt(O,["self"])},[e("div",ws,[e("div",Cs,[e("div",Ts,[e("button",{class:"cpt-slideout-back",onClick:O},[...t[56]||(t[56]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",width:"20",height:"20"},[e("path",{d:"M15 19l-7-7 7-7","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),e("div",null,[t[57]||(t[57]=e("div",{class:"cpt-slideout-title"},"Transaction Details",-1)),e("div",Ss,c(u.value.site_name||"Unknown Site"),1)])]),e("span",{class:f(["cpt-slideout-status",u.value.status])},c(u.value.status==="complete"?"Completed":"Cancelled"),3)]),e("div",Ds,[e("div",{class:f(["cpt-slideout-hero",u.value.status])},[e("div",xs,c(U(P)(parseFloat(u.value.cust_amount||0),u.value.currency)),1),e("div",Ms,[t[58]||(t[58]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",width:"14",height:"14"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 6v6l4 2"})],-1)),y(" "+c(W(u.value.transaction_date).date)+" at "+c(W(u.value.transaction_date).time),1)])],2),u.value.is_test||u.value.is_refund||u.value.is_chargeback?(r(),i("div",Bs,[u.value.is_test?(r(),i("div",$s,[...t[59]||(t[59]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1),y(" Test Transaction ",-1)])])):_("",!0),u.value.is_refund?(r(),i("div",As,[...t[60]||(t[60]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1),y(" Refunded ",-1)])])):_("",!0),u.value.is_chargeback?(r(),i("div",Fs,[...t[61]||(t[61]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),y(" Chargeback ",-1)])])):_("",!0)])):_("",!0),e("div",Is,[t[64]||(t[64]=e("div",{class:"cpt-slideout-section-title"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",width:"16",height:"16"},[e("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})]),y(" Customer ")],-1)),e("div",Vs,[e("div",Es,[t[62]||(t[62]=e("span",{class:"cpt-slideout-card-label"},"Name",-1)),e("span",Ls,c(u.value.cust_name||"Unknown"),1)]),e("div",Rs,[t[63]||(t[63]=e("span",{class:"cpt-slideout-card-label"},"Email",-1)),e("span",Us,c(u.value.cust_email_ad||"No email"),1)])])]),e("div",Ps,[t[68]||(t[68]=e("div",{class:"cpt-slideout-section-title"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",width:"16",height:"16"},[e("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]),y(" Identifiers ")],-1)),e("div",js,[e("div",zs,[t[65]||(t[65]=e("span",{class:"cpt-slideout-card-label"},"Transaction ID",-1)),e("span",Ns,c(u.value.cust_trans_id||"—"),1)]),e("div",Os,[t[66]||(t[66]=e("span",{class:"cpt-slideout-card-label"},"Session ID",-1)),e("span",qs,c(u.value.cust_session||"—"),1)]),e("div",Zs,[t[67]||(t[67]=e("span",{class:"cpt-slideout-card-label"},"Type",-1)),e("span",Hs,c(u.value.trans_type||"Transaction"),1)])])])]),e("div",Gs,[e("button",{class:"cpt-slideout-btn secondary",onClick:O}," Close "),e("button",{class:f(["cpt-slideout-btn",u.value.is_test?"active test":"outline"]),onClick:St},[t[69]||(t[69]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",width:"16",height:"16"},[e("path",{d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),y(" "+c(u.value.is_test?"Remove Test":"Mark Test"),1)],2),u.value.status==="complete"?(r(),i("button",{key:0,class:f(["cpt-slideout-btn",u.value.is_refund?"active refund":"outline"]),onClick:t[26]||(t[26]=s=>Tt("is_refund","refund_date"))},[t[70]||(t[70]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",width:"16",height:"16"},[e("path",{d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),y(" "+c(u.value.is_refund?"Remove Refund":"Mark Refund"),1)],2)):_("",!0),u.value.status==="complete"?(r(),i("button",{key:1,class:f(["cpt-slideout-btn",u.value.is_chargeback?"active chargeback":"outline"]),onClick:t[27]||(t[27]=s=>Tt("is_chargeback","chargeback_date"))},[t[71]||(t[71]=e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",width:"16",height:"16"},[e("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),y(" "+c(u.value.is_chargeback?"Remove CB":"Mark CB"),1)],2)):_("",!0)])])])):_("",!0)]),_:1})]))]))}},ta=Qt(Js,[["__scopeId","data-v-4c4eea03"]]);export{ta as default};
