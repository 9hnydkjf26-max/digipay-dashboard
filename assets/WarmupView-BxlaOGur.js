import{_ as A,r as d,i as b,o as I,c as f,e as n,k as y,f as L,g as M,t as p,q as S,n as w,E as T,m as F,p as U,h as D}from"./index-BwJJocST.js";import{S as R}from"./StatsGrid-v5lPiAGm.js";import{D as W}from"./DataTable-C09v9PhQ.js";const B={class:"main-content"},$={class:"container"},q={class:"page-header"},z=["disabled"],O={key:0,class:"loading-spinner"},G={class:"progress-cell"},H={class:"progress-bar"},j={class:"progress-text"},J={__name:"WarmupView",setup(K){const{supabase:v}=F(),{error:k}=U(),i=d(!1),m=d([]),c=d([]),x=b(()=>{const t=m.value.length,s=m.value.filter(l=>l.is_active).length,e=c.value.reduce((l,a)=>l+(a.total_volume||0),0),r=c.value.length>0?(c.value.reduce((l,a)=>l+(a.completion_pct||0),0)/c.value.length).toFixed(0):0;return[{label:"Total Sites",value:t.toString()},{label:"Active Sites",value:s.toString()},{label:"Total Volume",value:_(e)},{label:"Avg Completion",value:`${r}%`}]}),V=[{key:"site_name",label:"Site",sortable:!0},{key:"monthly_limit",label:"Monthly Limit",sortable:!0},{key:"current_volume",label:"Current Volume",sortable:!0},{key:"completion",label:"Completion",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"last_transaction",label:"Last Transaction",sortable:!0}],C=b(()=>c.value.map(t=>({site_name:t.site_name||"Unknown",monthly_limit:_(t.monthly_limit||0),current_volume:_(t.current_volume||0),completion:`${t.completion_pct||0}%`,completion_raw:t.completion_pct||0,status:t.status||"Active",last_transaction:E(t.last_transaction_date)})));function _(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}function E(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Never"}async function N(){try{const{data:t,error:s}=await v.from("cpt_site_accounts").select("*").order("site_name");if(s)throw s;m.value=t||[]}catch(t){console.error("Error loading sites:",t)}}async function g(){i.value=!0;try{const t=new Date;t.setDate(1),t.setHours(0,0,0,0);const{data:s,error:e}=await v.from("cpt_data").select("site_id, site_name, cust_amount, transaction_date").gte("transaction_date",t.toISOString()).eq("status","approved");if(e)throw e;const r={},l={};s==null||s.forEach(a=>{const o=a.site_id||"unknown";r[o]||(r[o]={site_id:o,site_name:a.site_name||o,total_volume:0,tx_count:0}),r[o].total_volume+=parseFloat(a.cust_amount||0),r[o].tx_count++;const u=new Date(a.transaction_date);(!l[o]||u>l[o])&&(l[o]=u)}),c.value=m.value.map(a=>{const o=r[a.site_id]||{total_volume:0,tx_count:0},u=a.monthly_limit||5e4,h=u>0?Math.min(o.total_volume/u*100,100):0;return{site_id:a.site_id,site_name:a.site_name||a.site_id,monthly_limit:u,current_volume:o.total_volume,completion_pct:Math.round(h),status:h>=100?"Limit Reached":a.is_active?"Active":"Inactive",last_transaction_date:l[a.site_id],total_volume:o.total_volume}})}catch(t){console.error("Error loading warmup data:",t),k("Error loading warmup data")}finally{i.value=!1}}return I(async()=>{await N(),await g()}),(t,s)=>(D(),f("div",B,[n("div",$,[n("div",q,[s[0]||(s[0]=n("div",null,[n("h1",{class:"page-title"},"Warm Up"),n("p",{class:"page-subtitle"},"Merchant compliance and transaction limit tracking")],-1)),n("button",{class:"btn btn-primary",onClick:g,disabled:i.value},[i.value?(D(),f("span",O)):L("",!0),M(" "+p(i.value?"Refreshing...":"Refresh Data"),1)],8,z)]),y(R,{stats:x.value,loading:i.value},null,8,["stats","loading"]),y(W,{columns:V,data:C.value,loading:i.value,"empty-message":"No warmup data available"},{"cell-completion":S(({row:e})=>[n("div",G,[n("div",H,[n("div",{class:w(["progress-fill",{"progress-success":e.completion_raw>=100,"progress-warning":e.completion_raw>=75&&e.completion_raw<100,"progress-info":e.completion_raw<75}]),style:T({width:`${e.completion_raw}%`})},null,6)]),n("span",j,p(e.completion),1)])]),"cell-status":S(({value:e})=>[n("span",{class:w(["badge",{"badge-success":e==="Active","badge-warning":e==="Limit Reached","badge-neutral":e==="Inactive"}])},p(e),3)]),_:1},8,["data","loading"])])]))}},Y=A(J,[["__scopeId","data-v-1b1709ac"]]);export{Y as default};
