import{_ as J,u as K,r,i as M,o as O,c as g,e,y as Q,F as R,w as i,k as f,n as y,l as N,q as u,t as _,s as $,v as m,x as W,g as F,z as I,m as X,p as Z,h as A}from"./index-wOkIWAdy.js";import{D as P}from"./DataTable-BWzQFBUQ.js";import{M as T}from"./Modal-CyHwwixv.js";const tt={class:"main-content"},et={class:"container"},st={key:0,class:"alert alert-error"},at={class:"tabs"},ot={class:"section-header"},lt=["onClick"],nt={class:"section-header"},it=["onClick"],rt={class:"form-group"},ut={class:"form-group"},ct={class:"form-group"},dt={class:"form-group"},vt={class:"checkbox-label"},mt=["disabled"],pt={class:"form-group"},bt={class:"form-group"},ft={class:"form-group"},yt={class:"form-group"},_t={class:"checkbox-label"},gt=["disabled"],At={__name:"AdminView",setup(kt){const{supabase:p}=X(),{isAdmin:q}=K(),{success:k,error:b}=Z(),n=r(!1),S=r([]),w=r([]),c=r("accounts"),d=r(!1),v=r(!1),o=r({account_id:"",account_name:"",payment_provider:"stripe",is_active:!0}),l=r({site_id:"",site_name:"",monthly_limit:5e4,is_active:!0}),h=[{key:"account_name",label:"Account Name",sortable:!0},{key:"account_id",label:"Account ID",sortable:!0},{key:"payment_provider",label:"Provider",sortable:!0},{key:"is_active",label:"Status",sortable:!0},{key:"actions",label:"Actions",sortable:!1}],B=[{key:"site_name",label:"Site Name",sortable:!0},{key:"site_id",label:"Site ID",sortable:!0},{key:"monthly_limit",label:"Monthly Limit",sortable:!0},{key:"is_active",label:"Status",sortable:!0},{key:"actions",label:"Actions",sortable:!1}],z=M(()=>S.value.map(a=>{var t,s;return{...a,payment_provider:((t=a.payment_provider)==null?void 0:t.charAt(0).toUpperCase())+((s=a.payment_provider)==null?void 0:s.slice(1)),is_active:a.is_active?"Active":"Inactive"}})),L=M(()=>w.value.map(a=>({...a,monthly_limit:Y(a.monthly_limit||0),is_active:a.is_active?"Active":"Inactive"})));function Y(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(a)}async function C(){try{const{data:a,error:t}=await p.from("payment_accounts").select("*").order("account_name");if(t)throw t;S.value=a||[]}catch(a){console.error("Error loading accounts:",a),b("Error loading accounts")}}async function V(){try{const{data:a,error:t}=await p.from("cpt_site_accounts").select("*").order("site_name");if(t)throw t;w.value=a||[]}catch(a){console.error("Error loading sites:",a),b("Error loading sites")}}async function x(){n.value=!0;try{const{error:a}=await p.from("payment_accounts").upsert(o.value);if(a)throw a;k("Account saved successfully"),d.value=!1,D(),C()}catch(a){console.error("Error saving account:",a),b("Error saving account")}finally{n.value=!1}}async function U(){n.value=!0;try{const{error:a}=await p.from("cpt_site_accounts").upsert(l.value);if(a)throw a;k("Site saved successfully"),v.value=!1,E(),V()}catch(a){console.error("Error saving site:",a),b("Error saving site")}finally{n.value=!1}}function j(a){o.value={...a},d.value=!0}function G(a){l.value={...a},v.value=!0}function D(){o.value={account_id:"",account_name:"",payment_provider:"stripe",is_active:!0}}function E(){l.value={site_id:"",site_name:"",monthly_limit:5e4,is_active:!0}}return O(()=>{C(),V()}),(a,t)=>(A(),g("div",tt,[e("div",et,[t[27]||(t[27]=e("h1",{class:"page-title"},"Admin Settings",-1)),t[28]||(t[28]=e("p",{class:"page-subtitle"},"Manage payment accounts and site configurations",-1)),Q(q)?(A(),g(R,{key:1},[e("div",at,[e("button",{class:y(["tab",{active:c.value==="accounts"}]),onClick:t[0]||(t[0]=s=>c.value="accounts")}," Payment Accounts ",2),e("button",{class:y(["tab",{active:c.value==="sites"}]),onClick:t[1]||(t[1]=s=>c.value="sites")}," Site Accounts ",2)]),i(e("div",null,[e("div",ot,[t[16]||(t[16]=e("h2",{class:"section-title"},"Payment Accounts",-1)),e("button",{class:"btn btn-primary",onClick:t[2]||(t[2]=s=>{D(),d.value=!0})}," Add Account ")]),f(P,{columns:h,data:z.value,loading:n.value,"empty-message":"No accounts found"},{"cell-is_active":u(({value:s})=>[e("span",{class:y(["badge",s==="Active"?"badge-success":"badge-neutral"])},_(s),3)]),"cell-actions":u(({row:s})=>[e("button",{class:"btn btn-secondary btn-sm",onClick:H=>j(s)},"Edit",8,lt)]),_:1},8,["data","loading"])],512),[[N,c.value==="accounts"]]),i(e("div",null,[e("div",nt,[t[17]||(t[17]=e("h2",{class:"section-title"},"Site Accounts",-1)),e("button",{class:"btn btn-primary",onClick:t[3]||(t[3]=s=>{E(),v.value=!0})}," Add Site ")]),f(P,{columns:B,data:L.value,loading:n.value,"empty-message":"No sites found"},{"cell-is_active":u(({value:s})=>[e("span",{class:y(["badge",s==="Active"?"badge-success":"badge-neutral"])},_(s),3)]),"cell-actions":u(({row:s})=>[e("button",{class:"btn btn-secondary btn-sm",onClick:H=>G(s)},"Edit",8,it)]),_:1},8,["data","loading"])],512),[[N,c.value==="sites"]]),f(T,{modelValue:d.value,"onUpdate:modelValue":t[9]||(t[9]=s=>d.value=s),title:"Payment Account"},{footer:u(()=>[e("button",{class:"btn btn-secondary",onClick:t[8]||(t[8]=s=>d.value=!1)},"Cancel"),e("button",{class:"btn btn-primary",onClick:x,disabled:n.value},_(n.value?"Saving...":"Save Account"),9,mt)]),default:u(()=>[e("form",{onSubmit:$(x,["prevent"])},[e("div",rt,[t[18]||(t[18]=e("label",{class:"form-label"},"Account ID *",-1)),i(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[4]||(t[4]=s=>o.value.account_id=s),required:""},null,512),[[m,o.value.account_id]])]),e("div",ut,[t[19]||(t[19]=e("label",{class:"form-label"},"Account Name *",-1)),i(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[5]||(t[5]=s=>o.value.account_name=s),required:""},null,512),[[m,o.value.account_name]])]),e("div",ct,[t[21]||(t[21]=e("label",{class:"form-label"},"Payment Provider",-1)),i(e("select",{class:"form-select","onUpdate:modelValue":t[6]||(t[6]=s=>o.value.payment_provider=s)},[...t[20]||(t[20]=[e("option",{value:"stripe"},"Stripe",-1),e("option",{value:"airwallex"},"Airwallex",-1)])],512),[[W,o.value.payment_provider]])]),e("div",dt,[e("label",vt,[i(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=s=>o.value.is_active=s)},null,512),[[I,o.value.is_active]]),t[22]||(t[22]=F(" Active ",-1))])])],32)]),_:1},8,["modelValue"]),f(T,{modelValue:v.value,"onUpdate:modelValue":t[15]||(t[15]=s=>v.value=s),title:"Site Account"},{footer:u(()=>[e("button",{class:"btn btn-secondary",onClick:t[14]||(t[14]=s=>v.value=!1)},"Cancel"),e("button",{class:"btn btn-primary",onClick:U,disabled:n.value},_(n.value?"Saving...":"Save Site"),9,gt)]),default:u(()=>[e("form",{onSubmit:$(U,["prevent"])},[e("div",pt,[t[23]||(t[23]=e("label",{class:"form-label"},"Site ID *",-1)),i(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[10]||(t[10]=s=>l.value.site_id=s),required:""},null,512),[[m,l.value.site_id]])]),e("div",bt,[t[24]||(t[24]=e("label",{class:"form-label"},"Site Name *",-1)),i(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[11]||(t[11]=s=>l.value.site_name=s),required:""},null,512),[[m,l.value.site_name]])]),e("div",ft,[t[25]||(t[25]=e("label",{class:"form-label"},"Monthly Limit ($)",-1)),i(e("input",{type:"number",class:"form-input","onUpdate:modelValue":t[12]||(t[12]=s=>l.value.monthly_limit=s),step:"1000"},null,512),[[m,l.value.monthly_limit]])]),e("div",yt,[e("label",_t,[i(e("input",{type:"checkbox","onUpdate:modelValue":t[13]||(t[13]=s=>l.value.is_active=s)},null,512),[[I,l.value.is_active]]),t[26]||(t[26]=F(" Active ",-1))])])],32)]),_:1},8,["modelValue"])],64)):(A(),g("div",st," You do not have permission to access this page. "))])]))}},Vt=J(At,[["__scopeId","data-v-901cfa9b"]]);export{Vt as default};
